; filename: execve-ls-extended.nasm
; author: lawly
; description: invokes '//bin/ls --group-directories-first -l -t' via execve
;
; ADDR /bin/ls --group-directories-first -l -t 0x00000000 
; ^    ^       ^                         ^   ^
; |    |       |                         |   |
; ECX  EBX     EAX (borrow only)         ESI EDI
;

global _start

section .text
_start:

    xor edx, edx
    
    push edx
    push word 0x742d         ; "-t"
    mov edi, esp

    push edx
    push word 0x6c2d         ; -l
    mov esi, esp

    push edx
    push byte 0x74          ; size of immediate must be specified to prevent null bytes!
    push 0x73726966
    push 0x2d736569
    push 0x726f7463
    push 0x65726964
    push 0x2d70756f
    push 0x72672d2d         ; --group-directories-first
    mov eax, esp            ; only borrow EAX, we need it later!

    push edx
    push 0x736c2f6e
    push 0x69622f2f         ; //bin/ls
    mov ebx, esp

    push edx                ; push all elements of argv[] in reverse order onto stack
    push edi             
    push esi             
    push eax             
    push ebx             
    mov ecx, esp            

    xor eax, eax
    mov al, 0xb
    int 0x80